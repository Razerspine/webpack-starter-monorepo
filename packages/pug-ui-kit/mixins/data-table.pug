//- dataTable mixin
//- Renders a flexible table from an array of objects. Columns are derived
//- from the provided `columns` array or automatically collected from object keys.
//-
//- Parameters:
//-   items       - **Array** — Array of objects to render as rows. Each object
//-                 represents one row.
//-                 Default: []
//-   columns     - **Array | undefined** — Optional ordered list of keys to use
//-                 as columns. If omitted, unique keys are collected from `items`.
//-                 Default: auto-collected from items
//-   options     - **Object | undefined** — Configuration options:
//-                 - emptyText: **String** — Text shown when no rows; Default: 'No data'.
//-                 - showIndex: **Boolean** — Render leading index column; Default: false.
//-                 - formatters: **Object** — Map of column -> function(value) for custom rendering.
//-                   Example: { createdAt: v => new Date(v).toLocaleDateString() }.
//-                 - labels: **Object** — Map of column -> header label string.
//-                   Example: { id: 'ID', user_name: 'Name' }.
//-                 - actions: **Array** — List of action objects to render in the last column.
//-                   Replaces the deprecated block/slot mechanism.
//-                   Structure:
//-                     [
//-                       {
//-                         label: String,              // Text of the link/button
//-                         url: Function(item),        // Callback returning the URL string based on the row item
//-                         class: String (optional)    // CSS classes for the link
//-                       }
//-                     ]
//-                   Default: []
//-
//- Behavior:
//-   - Renders a table with Bootstrap-like classes (`table`).
//-   - If `items` is empty, displays a unified row with `emptyText`.
//-   - Actions are rendered as `<a>` tags in a separate column if `options.actions` is provided.
//-
//- Examples:
//-   const data = [{ id: 1, name: 'Alice' }, { id: 2, name: 'Bob' }];
//-
//-   // 1. Basic usage
//-   +dataTable(data)
//-
//-   // 2. Advanced usage with Actions and Custom Labels
//-   +dataTable(data, ['id', 'name'], {
//-     showIndex: true,
//-     labels: { name: 'Full Name' },
//-     actions: [
//-       {
//-         label: 'Edit',
//-         class: 'btn btn--text-primary btn--medium',
//-         url: (item) => `/users/${item.id}/edit`
//-       },
//-       {
//-         label: 'Delete',
//-         class: 'btn btn--text-secondary btn--medium',
//-         url: (item) => `/users/${item.id}/delete`
//-       }
//-     ]
//-   })
//-
//-   // 3. Explicit columns, labels and formatters
//-      +dataTable(data, ['id','name'], {
//-        showIndex: false,
//-        labels: { id: 'ID', name: 'Full name' },
//-        formatters: { id: v => '#' + v }
//-      })
//-
mixin dataTable(items, columns, options)
  - const _items = Array.isArray(items) ? items : [];
  - const cols = Array.isArray(columns) && columns.length ? columns : Array.from(new Set(_items.reduce((acc, it) => acc.concat(Object.keys(it || {})), [])));

  //- Default options
  - const opts = Object.assign({ emptyText: 'No data', showIndex: false, actions: [], formatters: {}, labels: {} }, options || {});

  //- Check if actions column is needed
  - const hasActions = Array.isArray(opts.actions) && opts.actions.length > 0;

  //- Helper: Humanize keys (user_id -> User id)
  - const humanize = function(key) {
  -   if (!key && key !== 0) return '';
  -   const s = String(key).replace(/_/g, ' ');
  -   return s.charAt(0).toUpperCase() + s.slice(1);
  - }

  //- Helper: Format cell values
  - const formatValue = function(v, col) {
  -   if (v === null || v === undefined || v === '') return '';
  -   if (opts.formatters && typeof opts.formatters[col] === 'function') return opts.formatters[col](v);
  -   if (Array.isArray(v)) return v.join(', ');
  -   if (typeof v === 'object') return JSON.stringify(v);
  -   return String(v);
  - }

  if !_items.length
    table.table.data-table
      thead
        tr
          th(colspan=cols.length + (opts.showIndex ? 1 : 0) + (hasActions ? 1 : 0)) #{opts.emptyText}
  else
    table.table.data-table
      thead
        tr
          if opts.showIndex
            th.data-table__index #
          each col in cols
            - const label = (opts.labels && Object.prototype.hasOwnProperty.call(opts.labels, col)) ? opts.labels[col] : humanize(col)
            th.data-table__header #{label}
          if hasActions
            th.data-table__actions Actions
      tbody
        each item, i in _items
          tr
            if opts.showIndex
              td.data-table__index #{i + 1}
            each col in cols
              - const val = (item && Object.prototype.hasOwnProperty.call(item, col)) ? item[col] : ''
              td.data-table__cell!= formatValue(val, col)
            if hasActions
              td.data-table__actions-cell
                each action in opts.actions
                  - const href = (typeof action.url === 'function') ? action.url(item) : '#'
                  - const className = action.class || ''
                  a(href=href class=className) #{action.label}
                  |
